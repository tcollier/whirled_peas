#!/usr/bin/env ruby

require 'bundler/setup'
require 'whirled_peas'
require 'whirled_peas/frame/event_loop'
require 'whirled_peas/frame/producer'
require 'whirled_peas/graphics/screen'

class TemplateFactory
  TITLE_FONT = :default #roman
  PRIMARY_COLOR = :bright_blue
  SECONDARY_COLOR = :blue
  BG_COLOR = :bright_white

  def build(name, args)
    WhirledPeas.template do |composer, settings|
      settings.set_padding(left: 10, top: 6, right: 10, bottom: 6)
      settings.align = :center
      settings.width = 120
      settings.flow = :t2b
      settings.bold = true
      settings.bg_color = BG_COLOR

      composer.add_box do |composer, settings|
        composer.add_text do |_, settings|
          settings.title_font = TITLE_FONT
          settings.color = PRIMARY_COLOR
          'Visualize'
        end
      end
      composer.add_box do |_, settings|
        settings.set_margin(top: 1)
        settings.color = SECONDARY_COLOR
        "your code's execution with"
      end
      composer.add_box do |composer, settings|
        settings.set_margin(top: 1)
        composer.add_text do |_, settings|
          settings.title_font = TITLE_FONT
          settings.color = PRIMARY_COLOR
          'Whirled Peas'
        end
      end
    end
  end
end

module WhirledPeas
  def self.intro
    template_factory = TemplateFactory.new
    screen = Graphics::Screen.new
    consumer = Frame::EventLoop.new(
      template_factory, refresh_rate: 100000
    )
    Frame::Producer.produce(consumer) do |producer|
      producer.send_frame('intro', args: {})
    end
  end
end

WhirledPeas.intro
